<!doctype html>
<html>
  <head>
    <title>Hoosat Wallet Test DApp</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #0a1628 0%, #1a2f45 100%);
        color: #e2e8f0;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #00d9a3;
        margin-bottom: 10px;
        font-size: 32px;
      }

      .subtitle {
        text-align: center;
        color: #718096;
        margin-bottom: 40px;
        font-size: 14px;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .section {
        background: #152033;
        border: 2px solid #1a2f45;
        border-radius: 12px;
        padding: 20px;
      }

      .section h2 {
        color: #00d9a3;
        font-size: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-icon {
        font-size: 24px;
      }

      .btn {
        width: 100%;
        padding: 12px 16px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-bottom: 10px;
        text-align: left;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .btn:last-child {
        margin-bottom: 0;
      }

      .btn-primary {
        background: linear-gradient(135deg, #00d9a3 0%, #00a87e 100%);
        color: #0a1628;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 217, 163, 0.5);
      }

      .btn-secondary {
        background: #1a2f45;
        color: #00d9a3;
        border: 2px solid #00d9a3;
      }

      .btn-secondary:hover {
        background: #243d5c;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .output {
        background: #0a1628;
        border: 1px solid #1a2f45;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        min-height: 100px;
        max-height: 300px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.6;
      }

      .output::-webkit-scrollbar {
        width: 8px;
      }

      .output::-webkit-scrollbar-track {
        background: #152033;
        border-radius: 4px;
      }

      .output::-webkit-scrollbar-thumb {
        background: rgba(0, 217, 163, 0.5);
        border-radius: 4px;
      }

      .log-entry {
        margin-bottom: 8px;
        padding: 8px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 4px;
        border-left: 3px solid #00d9a3;
      }

      .log-entry.error {
        border-left-color: #fc8181;
        background: rgba(252, 129, 129, 0.05);
      }

      .log-entry.success {
        border-left-color: #48bb78;
        background: rgba(72, 187, 120, 0.05);
      }

      .log-time {
        color: #718096;
        font-size: 11px;
        margin-right: 8px;
      }

      .log-icon {
        margin-right: 6px;
      }

      .status-bar {
        background: #152033;
        border: 2px solid #1a2f45;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px;
      }

      .status-item {
        text-align: center;
      }

      .status-label {
        font-size: 12px;
        color: #718096;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
      }

      .status-value {
        font-size: 18px;
        font-weight: 700;
        color: #00d9a3;
        word-break: break-all;
      }

      .status-value.disconnected {
        color: #fc8181;
      }

      .input-group {
        margin-bottom: 12px;
      }

      .input-group label {
        display: block;
        font-size: 12px;
        color: #a0aec0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
        font-weight: 600;
      }

      .input-group input,
      .input-group textarea {
        width: 100%;
        padding: 10px 12px;
        border: 2px solid #1a2f45;
        background: #0a1628;
        color: #e2e8f0;
        border-radius: 6px;
        font-size: 14px;
        font-family: 'Courier New', monospace;
        transition: border-color 0.2s;
      }

      .input-group textarea {
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
      }

      .input-group input:focus,
      .input-group textarea:focus {
        outline: none;
        border-color: #00d9a3;
        box-shadow: 0 0 0 3px rgba(0, 217, 163, 0.1);
      }

      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge.connected {
        background: rgba(72, 187, 120, 0.2);
        color: #48bb78;
      }

      .badge.disconnected {
        background: rgba(252, 129, 129, 0.2);
        color: #fc8181;
      }

      .clear-btn {
        background: transparent;
        color: #fc8181;
        border: 1px solid #fc8181;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 10px;
      }

      .clear-btn:hover {
        background: rgba(252, 129, 129, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ü¶ä Hoosat Wallet Test DApp</h1>
      <p class="subtitle">Complete testing suite for Hoosat Wallet extension</p>

      <!-- Status Bar -->
      <div class="status-bar">
        <div class="status-item">
          <div class="status-label">Connection Status</div>
          <div class="status-value" id="connectionStatus">
            <span class="badge disconnected">Not Connected</span>
          </div>
        </div>
        <div class="status-item">
          <div class="status-label">Wallet Address</div>
          <div class="status-value disconnected" id="walletAddress">-</div>
        </div>
        <div class="status-item">
          <div class="status-label">Balance</div>
          <div class="status-value" id="walletBalance">-</div>
        </div>
      </div>

      <!-- Main Grid -->
      <div class="grid" style="margin-top: 30px">
        <!-- Connection Section -->
        <div class="section">
          <h2><span class="section-icon">üîå</span> Connection</h2>
          <button class="btn btn-primary" onclick="connect()"><span>üîó</span> Connect Wallet</button>
          <button class="btn btn-secondary" onclick="disconnectWallet()"><span>üîå</span> Disconnect Wallet</button>
          <button class="btn btn-secondary" onclick="getAccounts()"><span>üë§</span> Get Accounts</button>
          <button class="btn btn-secondary" onclick="getNetwork()"><span>üåê</span> Get Network</button>
        </div>

        <!-- Balance Section -->
        <div class="section">
          <h2><span class="section-icon">üí∞</span> Balance</h2>
          <button class="btn btn-primary" onclick="getBalance()"><span>üíµ</span> Get Balance</button>
          <button class="btn btn-secondary" onclick="refreshBalance()"><span>üîÑ</span> Refresh Balance</button>
        </div>

        <!-- Transaction Section -->
        <div class="section">
          <h2><span class="section-icon">üì§</span> Send Transaction</h2>
          <div class="input-group">
            <label>Recipient Address</label>
            <input
              type="text"
              id="txTo"
              value="hoosat:qypm0hdlq777m2s6njukl70n7c8qmech3n9mjj7erl6hclttuvpjmpqgyu75ut6"
              placeholder="hoosat:..."
            />
          </div>
          <div class="input-group">
            <label>Amount (HTN)</label>
            <input type="number" id="txAmount" value="0.00001" step="0.00001" placeholder="0.1" />
          </div>
          <button class="btn btn-primary" onclick="sendTx()"><span>üöÄ</span> Send Transaction</button>
        </div>

        <!-- Sign Message Section -->
        <div class="section">
          <h2><span class="section-icon">‚úçÔ∏è</span> Sign Message</h2>
          <div class="input-group">
            <label>Message to Sign</label>
            <textarea id="signMessage" placeholder="Enter message to sign...">Hello, Hoosat!</textarea>
          </div>
          <button class="btn btn-primary" onclick="signMessage()"><span>‚úçÔ∏è</span> Sign Message</button>
          <button class="btn btn-secondary" onclick="signJSON()"><span>üìã</span> Sign JSON Data</button>
          <button class="btn btn-secondary" onclick="signLongMessage()"><span>üìù</span> Sign Long Message</button>
        </div>

        <!-- Authentication Section -->
        <div class="section">
          <h2><span class="section-icon">üîê</span> Authentication</h2>
          <button class="btn btn-primary" onclick="authenticate()"><span>üîë</span> Authenticate with Wallet</button>
          <button class="btn btn-secondary" onclick="verifyOwnership()"><span>‚úÖ</span> Verify Address Ownership</button>
          <p style="margin-top: 12px; font-size: 12px; color: #718096; line-height: 1.6">
            This demonstrates using sign message for authentication without gas fees.
          </p>
        </div>

        <!-- Test Scenarios Section -->
        <div class="section">
          <h2><span class="section-icon">üß™</span> Test Scenarios</h2>
          <button class="btn btn-secondary" onclick="testRejectMessage()"><span>‚ùå</span> Test Reject Message</button>
          <button class="btn btn-secondary" onclick="testSpecialCharacters()"><span>üî§</span> Test Special Characters</button>
          <button class="btn btn-secondary" onclick="testEmptyMessage()"><span>‚ö†Ô∏è</span> Test Empty Message</button>
          <button class="btn btn-secondary" onclick="runAllTests()"><span>üö¶</span> Run All Tests</button>
        </div>
      </div>

      <!-- Console Output -->
      <div class="section">
        <h2>
          <span class="section-icon">üìü</span> Console Output
          <button class="clear-btn" onclick="clearOutput()" style="margin-left: auto">Clear</button>
        </h2>
        <div class="output" id="output"></div>
      </div>
    </div>

    <script>
      let connectedAddress = null;

      function log(msg, type = 'info') {
        const output = document.getElementById('output');
        const time = new Date().toLocaleTimeString();
        const icons = {
          info: '‚ÑπÔ∏è',
          success: '‚úÖ',
          error: '‚ùå',
          warning: '‚ö†Ô∏è',
        };

        const entry = document.createElement('div');
        entry.className = `log-entry ${type}`;
        entry.innerHTML = `<span class="log-time">${time}</span><span class="log-icon">${icons[type] || icons.info}</span>${msg}`;

        output.appendChild(entry);
        output.scrollTop = output.scrollHeight;
      }

      function updateStatus() {
        const statusEl = document.getElementById('connectionStatus');
        const addressEl = document.getElementById('walletAddress');

        if (connectedAddress) {
          statusEl.innerHTML = '<span class="badge connected">Connected</span>';
          addressEl.className = 'status-value';
          addressEl.textContent = connectedAddress.substring(0, 20) + '...';
        } else {
          statusEl.innerHTML = '<span class="badge disconnected">Not Connected</span>';
          addressEl.className = 'status-value disconnected';
          addressEl.textContent = '-';
        }
      }

      function clearOutput() {
        document.getElementById('output').innerHTML = '';
      }

      // Connection Tests
      async function connect() {
        try {
          log('üîå Requesting wallet connection...', 'info');
          const accounts = await window.hoosat.requestAccounts();
          connectedAddress = accounts[0];
          log(`‚úÖ Connected: ${accounts[0]}`, 'success');
          updateStatus();
          await refreshBalance();
        } catch (error) {
          log(`‚ùå Connection error: ${error.message}`, 'error');
        }
      }

      async function disconnectWallet() {
        try {
          log('üîå Disconnecting wallet...', 'info');
          await window.hoosat.disconnect();
          connectedAddress = null;
          log('‚úÖ Wallet disconnected successfully', 'success');
          log('üí° The site has been removed from Connected Sites', 'info');
          updateStatus();
          document.getElementById('walletBalance').textContent = '-';
        } catch (error) {
          log(`‚ùå Disconnect error: ${error.message}`, 'error');
        }
      }

      async function getAccounts() {
        try {
          const accounts = await window.hoosat.getAccounts();
          if (accounts.length > 0) {
            connectedAddress = accounts[0];
            log(`üë§ Accounts: ${accounts.join(', ')}`, 'success');
            updateStatus();
          } else {
            log('‚ö†Ô∏è No accounts found. Please connect first.', 'warning');
          }
        } catch (error) {
          log(`‚ùå Error: ${error.message}`, 'error');
        }
      }

      async function getNetwork() {
        try {
          const network = await window.hoosat.getNetwork();
          log(`üåê Network: ${network}`, 'success');
        } catch (error) {
          log(`‚ùå Error: ${error.message}`, 'error');
        }
      }

      // Balance Tests
      async function getBalance() {
        try {
          const accounts = await window.hoosat.getAccounts();
          if (accounts.length === 0) {
            log('‚ö†Ô∏è Please connect wallet first', 'warning');
            return;
          }
          const balance = await window.hoosat.getBalance(accounts[0]);
          const balanceHTN = (parseInt(balance) / 100000000).toFixed(8);
          log(`üí∞ Balance: ${balanceHTN} HTN (${balance} sompi)`, 'success');
          document.getElementById('walletBalance').textContent = balanceHTN + ' HTN';
        } catch (error) {
          log(`‚ùå Error: ${error.message}`, 'error');
        }
      }

      async function refreshBalance() {
        await getBalance();
      }

      // Transaction Tests
      async function sendTx() {
        try {
          const to = document.getElementById('txTo').value;
          const amount = parseFloat(document.getElementById('txAmount').value);

          if (!to || !amount) {
            log('‚ö†Ô∏è Please fill in recipient address and amount', 'warning');
            return;
          }

          log(`üì§ Sending ${amount} HTN to ${to.substring(0, 20)}...`, 'info');

          const txId = await window.hoosat.sendTransaction({
            to: to,
            amount: amount,
          });

          log(`‚úÖ Transaction sent! TX ID: ${txId}`, 'success');
          log(`üîó Explorer: https://explorer.hoosat.fi/tx/${txId}`, 'info');

          // Refresh balance after transaction
          setTimeout(refreshBalance, 2000);
        } catch (error) {
          log(`‚ùå Transaction error: ${error.message}`, 'error');
        }
      }

      // Sign Message Tests
      async function signMessage() {
        try {
          const message = document.getElementById('signMessage').value;

          if (!message) {
            log('‚ö†Ô∏è Please enter a message to sign', 'warning');
            return;
          }

          log(`‚úçÔ∏è Signing message: "${message}"`, 'info');

          const signature = await window.hoosat.signMessage(message);

          log(`‚úÖ Message signed successfully!`, 'success');
          log(`üìù Message: ${message}`, 'info');
          log(`üîê Signature: ${signature}`, 'success');
          log(`üìè Signature length: ${signature.length} characters`, 'info');
        } catch (error) {
          log(`‚ùå Sign error: ${error.message}`, 'error');
        }
      }

      async function signJSON() {
        try {
          const jsonData = {
            action: 'login',
            timestamp: Date.now(),
            nonce: Math.random().toString(36).substring(7),
            data: {
              username: 'testuser',
              domain: 'example.com',
            },
          };

          const message = JSON.stringify(jsonData, null, 2);
          log(`‚úçÔ∏è Signing JSON data...`, 'info');
          log(`üìã Data: ${message}`, 'info');

          const signature = await window.hoosat.signMessage(message);

          log(`‚úÖ JSON signed successfully!`, 'success');
          log(`üîê Signature: ${signature}`, 'success');
        } catch (error) {
          log(`‚ùå Sign error: ${error.message}`, 'error');
        }
      }

      async function signLongMessage() {
        try {
          const longMessage =
            `This is a very long message that will test the UI's ability to display long content. `.repeat(20) +
            `This message is intentionally long to test:
          1. UI truncation in the approval screen
          2. Scrolling behavior
          3. Signature generation for large messages
          4. Performance with longer content

          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.`;

          log(`‚úçÔ∏è Signing long message (${longMessage.length} characters)...`, 'info');

          const signature = await window.hoosat.signMessage(longMessage);

          log(`‚úÖ Long message signed successfully!`, 'success');
          log(`üìè Message length: ${longMessage.length} characters`, 'info');
          log(`üîê Signature: ${signature}`, 'success');
        } catch (error) {
          log(`‚ùå Sign error: ${error.message}`, 'error');
        }
      }

      // Authentication Tests
      async function authenticate() {
        try {
          const accounts = await window.hoosat.getAccounts();
          if (accounts.length === 0) {
            log('‚ö†Ô∏è Please connect wallet first', 'warning');
            return;
          }

          const nonce = Math.random().toString(36).substring(2, 15);
          const timestamp = Date.now();
          const message = `Sign this message to authenticate:\n\nAddress: ${accounts[0]}\nNonce: ${nonce}\nTimestamp: ${timestamp}`;

          log(`üîë Authenticating with wallet...`, 'info');

          const signature = await window.hoosat.signMessage(message);

          log(`‚úÖ Authentication successful!`, 'success');
          log(`üë§ Address: ${accounts[0]}`, 'info');
          log(`üé≤ Nonce: ${nonce}`, 'info');
          log(`‚è∞ Timestamp: ${new Date(timestamp).toLocaleString()}`, 'info');
          log(`üîê Signature: ${signature}`, 'success');
          log(`üí° In production, send signature to your backend for verification`, 'info');
        } catch (error) {
          log(`‚ùå Authentication failed: ${error.message}`, 'error');
        }
      }

      async function verifyOwnership() {
        try {
          const accounts = await window.hoosat.getAccounts();
          if (accounts.length === 0) {
            log('‚ö†Ô∏è Please connect wallet first', 'warning');
            return;
          }

          const message = `I verify that I own this Hoosat address: ${accounts[0]}`;

          log(`‚úÖ Requesting ownership verification...`, 'info');

          const signature = await window.hoosat.signMessage(message);

          log(`‚úÖ Ownership verified!`, 'success');
          log(`üìù Statement: "${message}"`, 'info');
          log(`üîê Proof (signature): ${signature}`, 'success');
        } catch (error) {
          log(`‚ùå Verification failed: ${error.message}`, 'error');
        }
      }

      // Test Scenarios
      async function testRejectMessage() {
        try {
          log(`‚ö†Ô∏è Testing reject scenario... Please click "Reject" in the popup`, 'warning');
          const signature = await window.hoosat.signMessage('Test reject - please reject this');
          log(`‚ùå Test failed: should have been rejected`, 'error');
        } catch (error) {
          if (error.message.includes('rejected')) {
            log(`‚úÖ Reject test passed: ${error.message}`, 'success');
          } else {
            log(`‚ùå Unexpected error: ${error.message}`, 'error');
          }
        }
      }

      async function testSpecialCharacters() {
        try {
          const specialMessage = `Special characters test: !@#$%^&*()_+-=[]{}|;':",./<>?\n\nEmoji: ü¶äüí∞‚úÖ‚ùå\n\nUnicode: caf√©, na√Øve, Êó•Êú¨Ë™û`;

          log(`‚úçÔ∏è Testing special characters and Unicode...`, 'info');

          const signature = await window.hoosat.signMessage(specialMessage);

          log(`‚úÖ Special characters signed successfully!`, 'success');
          log(`üîê Signature: ${signature}`, 'success');
        } catch (error) {
          log(`‚ùå Error: ${error.message}`, 'error');
        }
      }

      async function testEmptyMessage() {
        try {
          log(`‚ö†Ô∏è Testing empty message (should fail)...`, 'warning');
          const signature = await window.hoosat.signMessage('');
          log(`‚ùå Test failed: empty message should be rejected`, 'error');
        } catch (error) {
          log(`‚úÖ Empty message test passed: ${error.message}`, 'success');
        }
      }

      async function runAllTests() {
        log(`üö¶ Running all tests...`, 'info');
        log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'info');

        // Test 1: Simple message
        try {
          log(`[1/5] Testing simple message...`, 'info');
          await window.hoosat.signMessage('Test message 1');
          log(`‚úÖ Test 1 passed: Simple message`, 'success');
        } catch (error) {
          log(`‚ùå Test 1 failed: ${error.message}`, 'error');
        }

        await new Promise(resolve => setTimeout(resolve, 1000));

        // Test 2: JSON data
        try {
          log(`[2/5] Testing JSON data...`, 'info');
          await window.hoosat.signMessage(JSON.stringify({ test: 'data' }));
          log(`‚úÖ Test 2 passed: JSON data`, 'success');
        } catch (error) {
          log(`‚ùå Test 2 failed: ${error.message}`, 'error');
        }

        await new Promise(resolve => setTimeout(resolve, 1000));

        // Test 3: Special characters
        try {
          log(`[3/5] Testing special characters...`, 'info');
          await window.hoosat.signMessage('Test: !@#$%^&*() ü¶ä');
          log(`‚úÖ Test 3 passed: Special characters`, 'success');
        } catch (error) {
          log(`‚ùå Test 3 failed: ${error.message}`, 'error');
        }

        await new Promise(resolve => setTimeout(resolve, 1000));

        // Test 4: Long message
        try {
          log(`[4/5] Testing long message...`, 'info');
          await window.hoosat.signMessage('Long message test. '.repeat(50));
          log(`‚úÖ Test 4 passed: Long message`, 'success');
        } catch (error) {
          log(`‚ùå Test 4 failed: ${error.message}`, 'error');
        }

        await new Promise(resolve => setTimeout(resolve, 1000));

        // Test 5: Authentication flow
        try {
          log(`[5/5] Testing authentication flow...`, 'info');
          const accounts = await window.hoosat.getAccounts();
          await window.hoosat.signMessage(`Auth test: ${accounts[0]}`);
          log(`‚úÖ Test 5 passed: Authentication flow`, 'success');
        } catch (error) {
          log(`‚ùå Test 5 failed: ${error.message}`, 'error');
        }

        log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'info');
        log(`üèÅ All tests completed!`, 'success');
      }

      // Check if Hoosat provider is available
      window.addEventListener('load', () => {
        if (typeof window.hoosat !== 'undefined') {
          log('‚úÖ Hoosat wallet provider detected', 'success');
          log('‚ÑπÔ∏è Ready to test! Start by connecting your wallet.', 'info');
        } else {
          log('‚ùå Hoosat wallet provider not found. Please install the extension.', 'error');
        }
      });
    </script>
  </body>
</html>
